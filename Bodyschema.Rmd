---
title: 'Bodyschema'
author: "CÃ©dric Berther"
date: "22/05/2023"
output:
  pdf_document: default
  html_document: default
---

#   1 Data Preparation

##  1.1 Load packages

```{r}
install.packages("tidyverse") 
library(tidyverse) 

library(readr)
library(purrr)


```

##  1.2 Create CSV files

```{r, warning=FALSE}
# Specify the directory path

txt_to_csv <- function(file) {
  data <- readLines(file)
  data <- gsub(" ", ",", data)  # Replace spaces with commas
  data <- strsplit(data, ",")
  data <- do.call(rbind, data)
  write.csv(data, paste0(tools::file_path_sans_ext(file), ".csv"), row.names = FALSE)
}

# Get a list of all text files in the directory
files <- list.files(pattern = "*.txt")

# Convert each text file to CSV
lapply(files, txt_to_csv)

```

##  1.3 Load files

```{r, warning=FALSE}

files <- list.files(pattern = "*.csv", full.names = TRUE)

data <- map(files, ~ read_csv(.)) # using a formula based on a function

df <- tibble(files, data) %>%  
  mutate(id = str_extract(.[1, 1], "\\d+(?=,)")) %>% 
  select(id, data)

for (i in seq_along(df$data)) {
  second_row <- df$data[[i]][2, 1]
  df$id[i] <- second_row
  
  condition <- df$data[[i]][2, 3]
  df$condition[i] <- condition
}

```